<script>
    // ===== LISTA DE CANCIONES =====
    const songsList = [
        {
            title: "My Lord, What a Morning",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-MyLordWhatAMorning.mp3",
            duration: "2:45"
        },
        {
            title: "Sweeter As The Days Go By",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-SweeterAsTheDaysGoBy.mp3",
            duration: "3:12"
        },
        {
            title: "Dark Was the Night, Cold Was the Ground",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-DarkWasTheNightColdWasTheGround.mp3",
            duration: "3:05"
        },
        {
            title: "John the Revelator",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-JohnTheRevelator.mp3",
            duration: "3:19"
        },
        {
            title: "God Moves on the Water",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-GodMovesOnTheWater.mp3",
            duration: "2:58"
        },
        {
            title: "If I Had My Way I'd Tear the Building Down",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-IfIHadMyWayIdTearTheBuildingDown.mp3",
            duration: "3:02"
        },
        {
            title: "Pasitos Para Bailar",
            artist: "Agua Marina",
            url: "https://archive.org/download/agua-marina-exitos-de-oro-2014-942/Agua%20Marina%20-%20%C3%89xitos%20De%20Oro%20%282014%29%20-Xendra%20Music%20%2BDesconocido/14.%20Pasitos%20para%20Bailar.mp3",
            duration: "2:50"
        },
        {
            title: "I'm a Soldier in the Army of the Lord",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImASoldierInTheArmyOfTheLord.mp3",
            duration: "2:38"
        },
        {
            title: "The Soul of a Man",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-TheSoulOfAMan.mp3",
            duration: "3:07"
        },
        {
            title: "It's Nobody's Fault but Mine",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-ItsNobodySFaultButMine.mp3",
            duration: "3:15"
        },
        {
            title: "Mother's Children Have a Hard Time",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-MothersChildrenHaveAHardTime.mp3",
            duration: "3:00"
        },
        {
            title: "Jesus Make Up My Dying Bed",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-JesusMakeUpMyDyingBed.mp3",
            duration: "2:55"
        },
        {
            title: "Bye and Bye I'm Goin' to See the King",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ByeAndByeImGoinToSeeTheKing.mp3",
            duration: "2:40"
        },
        {
            title: "Lord I Just Can't Keep From Crying",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-LordIJustCantKeepFromCrying.mp3",
            duration: "3:10"
        },
        {
            title: "You'll Need Somebody on Your Bond",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-YoullNeedSomebodyOnYourBond.mp3",
            duration: "2:52"
        },
        {
            title: "I Know His Blood Can Make Me Whole",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-IKnowHisBloodCanMakeMeWhole.mp3",
            duration: "2:57"
        },
        {
            title: "Go with Me to That Land",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-GoWithMeToThatLand.mp3",
            duration: "2:48"
        },
        {
            title: "I Was Born to Preach the Gospel",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-IWasBornToPreachTheGospel.mp3",
            duration: "3:03"
        },
        {
            title: "Keep Your Lamp Trimmed and Burning",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-KeepYourLampTrimmedAndBurning.mp3",
            duration: "2:59"
        },
        {
            title: "Can't Nobody Hide from God",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-CantNobodyHideFromGod.mp3",
            duration: "3:06"
        },
        {
            title: "Take Your Burden to the Lord",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-TakeYourBurdenToTheLord.mp3",
            duration: "2:53"
        },
        {
            title: "When the War Was On",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-WhenTheWarWasOn.mp3",
            duration: "3:11"
        },
        {
            title: "Church I'm Fully Saved Today",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-ChurchImFullySavedToday.mp3",
            duration: "2:54"
        },
        {
            title: "I'm Gonna Run to the City of Refuge",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-ImGonnaRunToTheCityOfRefuge.mp3",
            duration: "3:08"
        },
        {
            title: "Let Your Light Shine on Me",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-LetYourLightShineOnMe.mp3",
            duration: "2:56"
        },
        {
            title: "God Don't Never Change",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-GodDontNeverChange.mp3",
            duration: "3:01"
        },
        {
            title: "The Rain Don't Fall on Me",
            artist: "Blind Willie Johnson",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindWillieJohnson-TheRainDontFallOnMe.mp3",
            duration: "3:04"
        },
        {
            title: "I'm Not Ashamed",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImNotAshamed.mp3",
            duration: "2:47"
        },
        {
            title: "He's a Gonner Now",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-HesAGonnerNow.mp3",
            duration: "2:51"
        },
        {
            title: "Jesus Is Coming Soon",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-JesusIsComingSoon.mp3",
            duration: "2:49"
        },
        {
            title: "Glory to His Name",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-GloryToHisName.mp3",
            duration: "2:46"
        },
        {
            title: "I've Got a Mother in Glory",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-IveGotAMotherInGlory.mp3",
            duration: "2:55"
        },
        {
            title: "I'm Going Home on the Morning Train",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImGoingHomeOnTheMorningTrain.mp3",
            duration: "2:42"
        },
        {
            title: "I'm a Pilgrim",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImAPilgrim.mp3",
            duration: "2:39"
        },
        {
            title: "Precious Memories",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-PreciousMemories.mp3",
            duration: "3:00"
        },
        {
            title: "I'll Be Rested When the Roll Is Called",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-IlBeRestedWhenTheRollIsCalled.mp3",
            duration: "3:10"
        },
        {
            title: "I'm Pressing On the Upward Way",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImPressingOnTheUpwardWay.mp3",
            duration: "2:44"
        },
        {
            title: "I've Got a Robe and a Crown",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-IveGotARobeAndACrown.mp3",
            duration: "2:52"
        },
        {
            title: "I'm Bound for the Kingdom",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImBoundForTheKingdom.mp3",
            duration: "2:48"
        },
        {
            title: "I'm Going to Live the Life I Sing About in My Song",
            artist: "Blind Joe Taggart",
            url: "https://archive.org/download/LibreMusicCollection_202007/BlindJoeTaggart-ImGoingToLiveTheLifeISingAboutInMySong.mp3",
            duration: "3:05"
        }
    ];

    const audio = new Audio();
    let isPlaying = false;
    let currentSongIndex = -1;
    let songElements = []; // Para actualizar iconos

    // Renderiza las canciones en el grid
    function renderSongs(songs) {
        const grid = document.getElementById('songsGrid');
        grid.innerHTML = '';

        if (songs.length === 0) {
            grid.innerHTML = `<div class="no-results">No tenemos esa canción :c</div>`;
            return;
        }

        songElements = []; // Reiniciar referencias

        songs.forEach((song, index) => {
            const songElement = document.createElement('div');
            songElement.className = 'song-item';
            songElement.innerHTML = `
                <div class="play-icon" id="icon-${index}">▶️</div>
                <div class="song-info">
                    <div class="song-title">${song.artist} - ${song.title}</div>
                    <div class="song-duration">${song.duration}</div>
                </div>
            `;
            songElement.onclick = () => playSong(song.url, song.title, song.artist, index);
            grid.appendChild(songElement);
            songElements.push({
                element: songElement,
                icon: songElement.querySelector(`#icon-${index}`)
            });
        });

        updateAllIcons(); // Sincronizar iconos tras renderizar
    }

    // Función para reproducir una canción
    function playSong(url, title, artist, index) {
        audio.src = url;
        audio.play();
        isPlaying = true;
        currentSongIndex = index;

        document.getElementById('playerTitle').textContent = title;
        document.getElementById('playerArtist').textContent = artist;

        updatePlayPauseButton();
        updateAllIcons();
        setupProgress();
    }

    // Alternar reproducción/pausa
    function togglePlayPause() {
        if (isPlaying) {
            audio.pause();
        } else {
            audio.play();
        }
        isPlaying = !isPlaying;

        updatePlayPauseButton();
        updateAllIcons();
    }

    // Actualizar botón de play/pause en el reproductor
    function updatePlayPauseButton() {
        const button = document.getElementById('playPauseButton');
        button.textContent = isPlaying ? '⏸️' : '▶️';
    }

    // Actualizar todos los iconos de la lista
    function updateAllIcons() {
        songElements.forEach((item, i) => {
            item.icon.textContent = (isPlaying && currentSongIndex === i) ? '⏸️' : '▶️';
        });
    }

    // Saltar canción
    function skipSong(direction) {
        if (currentSongIndex === -1) return;
        currentSongIndex += direction;
        if (currentSongIndex < 0) currentSongIndex = songsList.length - 1;
        if (currentSongIndex >= songsList.length) currentSongIndex = 0;

        const song = songsList[currentSongIndex];
        playSong(song.url, song.title, song.artist, currentSongIndex);
    }

    // Configurar barra de progreso
    function setupProgress() {
        const progressBar = document.getElementById('progressBar');
        const currentTime = document.getElementById('currentTime');
        const totalTime = document.getElementById('totalTime');

        // Actualizar barra y tiempos
        audio.addEventListener('timeupdate', () => {
            if (!audio.duration) return;
            const percent = (audio.currentTime / audio.duration) * 100;
            progressBar.value = percent;
            currentTime.textContent = formatTime(audio.currentTime);
            totalTime.textContent = formatTime(audio.duration);
        });

        // Reset al terminar
        audio.addEventListener('ended', () => {
            isPlaying = false;
            updatePlayPauseButton();
            updateAllIcons();
        });
    }

    // Buscar canciones
    function searchMusic() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        if (!query) {
            renderInitialSongs();
            return;
        }

        const filtered = songsList.filter(song => 
            song.title.toLowerCase().includes(query) || 
            song.artist.toLowerCase().includes(query)
        );

        renderSongs(filtered);
    }

    // Renderiza las primeras canciones según el dispositivo
    function renderInitialSongs() {
        const isMobile = window.innerWidth <= 768;
        const limit = isMobile ? 20 : 60;
        renderSongs(songsList.slice(0, limit));
    }

    // Modal de apoyo
    function openSupportModal() {
        document.getElementById('supportModal').classList.add('active');
    }

    function closeSupportModal() {
        document.getElementById('supportModal').classList.remove('active');
    }

    // Función para mover la barra manualmente
    function scrub(value) {
        const scrubTime = (value / 100) * audio.duration;
        audio.currentTime = scrubTime;
    }

    // Formatear tiempo
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
        return `${mins}:${secs}`;
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
        renderInitialSongs();
        updatePlayPauseButton(); // Inicia con ▶️

        // Escuchar cambios de estado del audio
        audio.addEventListener('play', () => {
            isPlaying = true;
            updatePlayPauseButton();
            updateAllIcons();
        });
        audio.addEventListener('pause', () => {
            isPlaying = false;
            updatePlayPauseButton();
            updateAllIcons();
        });
    });

    // Re-renderizar al cambiar tamaño de pantalla
    window.addEventListener('resize', () => {
        const query = document.getElementById('searchInput').value.trim();
        if (!query) {
            renderInitialSongs();
        }
    });
</script>
